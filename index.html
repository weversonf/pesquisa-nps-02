<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel NPS Master | Makro Engenharia</title>
    <link rel="icon" type="image/png" href="https://makroengenharia.com.br/wp-content/uploads/2023/03/favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --azul-profundo: #011f42; --azul-makro: #023F88;
            --vermelho-nps: #ED1C24; --amarelo-nps: #FFCC00; --verde-nps: #28a745;
            --branco: #FFFFFF; --glass: rgba(255, 255, 255, 0.05); --glass-border: rgba(255, 255, 255, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Montserrat', sans-serif; }
        body { background: radial-gradient(circle at top right, var(--azul-makro), var(--azul-profundo)); background-attachment: fixed; color: var(--branco); min-height: 100vh; }
        header { padding: 1.5rem; text-align: center; backdrop-filter: blur(12px); background: rgba(0, 0, 0, 0.3); border-bottom: 1px solid var(--glass-border); }
        .container { padding: 1.5rem; max-width: 1000px; margin: 0 auto; }
        .view { display: none; }
        .view.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Cards e MÃ©tricas */
        .card { background: var(--glass); backdrop-filter: blur(15px); padding: 2rem; border-radius: 20px; border: 1px solid var(--glass-border); margin-bottom: 20px; }
        .grid-metrics { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .card-metric { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 15px; text-align: center; border: 1px solid var(--glass-border); }
        .card-metric span { font-size: 10px; opacity: 0.7; text-transform: uppercase; display: block; }
        .card-metric h2 { font-size: 28px; margin-top: 5px; }

        /* Tabela */
        .table-wrapper { overflow-x: auto; margin-top: 20px; border-radius: 12px; background: rgba(0,0,0,0.2); }
        table { width: 100%; border-collapse: collapse; font-size: 11px; text-align: left; }
        th { background: rgba(255,255,255,0.1); padding: 15px; color: var(--vermelho-nps); text-transform: uppercase; }
        td { padding: 15px; border-bottom: 1px solid var(--glass-border); }

        .btn { background: var(--vermelho-nps); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 700; text-transform: uppercase; font-size: 11px; }
        input, select { background: rgba(255,255,255,0.1); border: 1px solid var(--glass-border); padding: 10px; border-radius: 8px; color: white; width: 100%; margin-bottom: 10px; }
    </style>
</head>
<body>

<header>
    <img src="https://makroengenharia.com.br/wp-content/uploads/2023/03/logo-1.png" width="130">
    <p style="font-size: 0.6rem; letter-spacing: 3px; opacity: 0.6; margin-top: 5px;">PAINEL MASTER | MAKRO ENGENHARIA</p>
</header>

<div class="container">
    <div class="view active" id="view-login">
        <div class="card" style="max-width: 400px; margin: 50px auto;">
            <h2 style="text-align: center; margin-bottom: 25px;">Acesso Restrito</h2>
            <input type="text" id="user-login" placeholder="UsuÃ¡rio">
            <input type="password" id="user-pass" placeholder="Senha">
            <button class="btn" style="width: 100%;" onclick="autenticar()">Entrar</button>
        </div>
    </div>

    <div class="view" id="view-dashboard">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 id="user-title">ADM MASTER: Weverson</h2>
            <div style="display: flex; gap: 10px;">
                <button class="btn" style="background:#007bff">ðŸ‘¥ GESTÃƒO</button>
                <button onclick="location.reload()" class="btn" style="background:rgba(255,255,255,0.1)">SAIR</button>
            </div>
        </div>

        <div class="grid-metrics">
            <div class="card-metric"><span>Total</span><h2 id="m-total">0</h2></div>
            <div class="card-metric" style="color:var(--verde-nps)"><span>Promotores</span><h2 id="m-promotores">0</h2></div>
            <div class="card-metric" style="color:var(--amarelo-nps)"><span>Neutros</span><h2 id="m-neutros">0</h2></div>
            <div class="card-metric" style="color:var(--vermelho-nps)"><span>Detratores</span><h2 id="m-detratores">0</h2></div>
            <div class="card-metric" style="background:var(--vermelho-nps)"><span>NPS Score</span><h2 id="m-nps">0</h2></div>
        </div>

        <div class="card">
            <canvas id="graficoNps" height="150"></canvas>
        </div>

        <div class="table-wrapper">
            <table id="tabela-respostas">
                <thead><tr><th>MÃªs</th><th>Cliente / OperaÃ§Ã£o</th><th>Nota</th><th>Feedback</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbwcsfpw1_uglhD6JtF4jAvjJ4hqgnHTcgKL8CBtb_i6pRmck7POOBvuqYykjIIE9sLdyQ/exec';

    function autenticar() {
        const user = document.getElementById('user-login').value;
        const pass = document.getElementById('user-pass').value;
        
        fetch(`${scriptURL}?action=login&user=${user}&pass=${pass}`)
        .then(res => res.json())
        .then(res => {
            if(res.result === "success") {
                document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
                document.getElementById('view-dashboard').classList.add('active');
                
                const dados = res.metrics.baseDados;
                const total = dados.length;
                const p = dados.filter(d => d.nota >= 9).length;
                const det = dados.filter(d => d.nota <= 6).length;
                const n = dados.filter(d => d.nota >= 7 && d.nota <= 8).length;
                const score = total > 0 ? Math.round(((p - det) / total) * 100) : 0;

                document.getElementById('m-total').innerText = total;
                document.getElementById('m-promotores').innerText = p;
                document.getElementById('m-neutros').innerText = n;
                document.getElementById('m-detratores').innerText = det;
                document.getElementById('m-nps').innerText = score;

                // Preenche a Tabela
                const tbody = document.querySelector('#tabela-respostas tbody');
                tbody.innerHTML = dados.map(d => `
                    <tr>
                        <td>${d.mes || '-'}</td>
                        <td><strong>${d.cliente}</strong><br><small>${d.contrato}</small></td>
                        <td><span style="background:${d.nota >= 9 ? 'var(--verde-nps)' : d.nota <= 6 ? 'var(--vermelho-nps)' : 'var(--amarelo-nps)'}; padding: 3px 8px; border-radius: 4px;">${d.nota}</span></td>
                        <td style="font-style:italic; opacity:0.8">"${d.feedback}"</td>
                    </tr>
                `).join('');

                // Renderiza GrÃ¡fico Simples
                new Chart(document.getElementById('graficoNps'), {
                    type: 'bar',
                    data: {
                        labels: ['Score Atual'],
                        datasets: [{ data: [score], backgroundColor: '#ED1C24' }]
                    },
                    options: { plugins: { legend: { display: false } }, scales: { y: { min: -100, max: 100 } } }
                });
            } else { alert("Erro no login!"); }
        });
    }
</script>
</body>
</html>
